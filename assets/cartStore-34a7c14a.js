import{B as n,C as f,r as i,b as v,s as w,c as m,g as S}from"./index-ba497632.js";const o={async getCartItem(){try{return(await n.get("/carts")).data.data.cart.cartItem}catch(s){throw s.response.data}},async addCartItem({productId:s,quantity:t}){try{return(await n.post("/carts",{productId:s,quantity:t})).data}catch(c){throw c.response.data}},async updateCartItem({quantity:s,cartItemId:t}){try{return(await n.patch(`/carts/${t}`,{quantity:s})).data}catch(c){throw c.response.data}},async deleteCartItem({cartItemId:s}){try{return(await n.delete(`/carts/${s}`)).data}catch(t){throw t.response.data}}},b=f("cart",()=>{const{showAlert:s}=S(),t=i([]),c=i(null),p=v(),{isProcessing:d,isLoading:y}=w(p),I=m(()=>t.value.length?t.value.reduce((a,e)=>a+=e.quantity*e.product.price,0):0),h=m(()=>t.value.length?t.value.reduce((a,e)=>a+=e.quantity,0):0);return{cartItems:t,errorMessage:c,totalPrice:I,cartItemsPrice:h,getCartItems:async()=>{try{t.value=await o.getCartItem()}catch(a){throw a.message}finally{y.value=!1}},addCartItem:async(a,e)=>{try{if(d.value=!0,e<1)return s("warning","數量不能小於1");const{status:r,message:u,data:C}=await o.addCartItem(a,e);if(r==="success"){const l=t.value.find(g=>g.product.id===a);return l?l.quantity=e:t.value=[{...C.cartItem},...t.value],{status:r,message:u}}}catch(r){throw r.message}finally{d.value=!1}},updateCartItem:async(a,e)=>{try{const r=t.value.find(u=>u.id===a);e<1||isNaN(e)?r.quantity=1:r.quantity=e,await o.updateCartItem({cartItemId:r.id,quantity:r.quantity})}catch(r){c.value=r.message}},deleteCartItem:async a=>{try{const{status:e}=await o.deleteCartItem({cartItemId:a});e==="success"&&(t.value=t.value.filter(r=>r.id!==a))}catch(e){c.value=e.message}}}});export{b as u};
