import{u as R,a as F,s as p,b as M,r as k,j as N,o as e,d as s,f as l,k as T,F as y,t as n,m as h,p as b,e as t,g as U}from"./index-ba497632.js";import{u as V}from"./orderStore-d52bf467.js";import{u as j}from"./adminStore-be10674f.js";import{S as q}from"./SpinnerLoading-c6094c35.js";import{h as E}from"./moment-a9aaa855.js";import"./cartStore-34a7c14a.js";const $={class:"container my-5"},z=t("div",{class:"row"},[t("div",{class:"col"},[t("h3",{class:"mb-4 font-weight-bold d-flex align-items-center"}," 訂單 ")])],-1),G={key:0,class:"text-center text-danger"},H={key:1},J=t("thead",null,[t("tr",null,[t("th",null,"訂單編號"),t("th",null,"日期"),t("th",null,"總價"),t("th",null,"詳細")])],-1),K=["onClick"],Q={key:0},W={colspan:"4"},X={class:"table table-bordered"},Y=t("thead",null,[t("tr",null,[t("th",{colspan:"2",class:"text-center"},"商品名稱"),t("th",null,"購買價格"),t("th",null,"數量")])],-1),Z={colspan:"2",class:"text-center"},I={key:0},tt=t("th",null,"買家姓名",-1),et=t("th",null,"買家email",-1),st=t("th",null,"買家電話",-1),nt=t("th",null,"買家地址",-1),lt=[tt,et,st,nt],rt={key:1},ot={key:2,class:"text-center"},mt={__name:"OrderList",setup(at){const S=R(),f=V(),A=j(),x=F(),{orderDetails:v,errorMessage:m,orders:c}=p(f),{currentUser:i}=p(x),O=M(),{isLoading:w,isProcessing:g}=p(O),{getAdminOrders:L}=A,{getOrderDetails:D,getOrders:B}=f,{showAlert:C}=U(),d=k(null),u=k(null);N(async()=>{try{i.value.isAdmin?await L():await B()}catch(o){return C("error",o),S.replace({name:"ProductList"})}});const P=async o=>{try{if(g.value=!0,d.value===o){d.value=null;return}if(i.value.isAdmin){const r=c.value.filter(a=>a.id===o);u.value=r[0].user}const _=await D({orderId:o});v.value=_.data.order.orderDetail,d.value=o}catch(_){m.value=_.message}finally{g.value=!1}};return(o,_)=>(e(),s("section",$,[l(w)?(e(),T(q,{key:0})):(e(),s(y,{key:1},[z,l(m)?(e(),s("p",G,n(l(m)),1)):h("",!0),l(c)&&l(c).length?(e(),s("div",H,[(e(!0),s(y,null,b(l(c),r=>(e(),s("table",{class:"table",key:r.id},[J,t("tbody",null,[t("tr",null,[t("td",null,n(r.id),1),t("td",null,n(l(E)(r.createdAt).format("L")),1),t("td",null,n(r.totalPrice),1),t("td",null,[t("button",{class:"btn btn-primary mt-3 px-5",onClick:a=>P(r.id)}," 展開 ",8,K)])]),d.value===r.id?(e(),s("tr",Q,[t("td",W,[t("table",X,[Y,t("tbody",null,[(e(!0),s(y,null,b(l(v),a=>(e(),s("tr",{key:a.id},[t("td",Z,n(a.product.name),1),t("td",null,n(a.priceAtTime),1),t("td",null,n(a.quantity),1)]))),128)),l(i).isAdmin?(e(),s("tr",I,lt)):h("",!0),l(i).isAdmin?(e(),s("tr",rt,[t("td",null,n(u.value.username),1),t("td",null,n(u.value.email),1),t("td",null,n(u.value.tel),1),t("td",null,n(u.value.address),1)])):h("",!0)])])])])):h("",!0)])]))),128))])):(e(),s("p",ot," 沒有訂單 "))],64))]))}};export{mt as default};
