import{h as E,u as L,a as G,i as H,b as J,s as h,r as g,j as K,x as O,c as Q,o as c,d as l,f as o,t as i,m as y,e,n as W,F as X,p as Y,w as R,v as Z,y as tt,z as et,g as st}from"./index-ba497632.js";import{u as ot}from"./cartStore-34a7c14a.js";import{h as nt}from"./moment-a9aaa855.js";const rt={class:"container my-5"},at=e("h3",{class:"mb-4 font-weight-bold text-dark"},"商品詳細資料",-1),it={key:0,class:"text-center text-danger"},ct={key:1,class:"row justify-content-center"},lt={class:"col-md-6"},ut=["src","alt"],dt={class:"col-md-6"},mt={class:"mb-3 font-weight-bold text-info"},vt={class:"mb-2"},pt={class:"mb-2"},_t={class:"mb-4"},ft={class:"d-flex justify-content-end"},bt=["disabled"],ht=["disabled"],gt=e("h2",{class:"my-4"}," 所有評論： ",-1),yt={key:0},wt=["onClick"],kt={class:"blockquote-footer"},xt=e("hr",null,null,-1),St={key:1,class:"text-center"},Ct={class:"form-group"},Rt=e("label",{for:"rating"},"rating",-1),Ft=et('<option value="" disabled selected>Enter rating</option><option value="1">1</option><option value="2">2</option><option value="3">3</option><option value="4">4</option><option value="5">5</option>',6),Nt=[Ft],$t={class:"form-group mb-4"},qt=e("label",{for:"text"},"留下評論：",-1),At={class:"d-flex align-items-center justify-content-between"},It={__name:"ProductDetail",setup(Pt){const f=E(),F=L(),w=G(),k=H(),N=ot(),$=J(),{isProcessing:x}=h($),{isAuthenticated:b,currentUser:S,favorites:m}=h(w),{product:a,errorMessage:C,reviews:d}=h(k),{getFavorites:q,addFavorite:A,removeFavorite:P,addReview:V,removeReview:j}=w,{getProduct:D}=k,{addCartItem:I}=N,{showAlert:r}=st(),u=g(!1),v=g(""),p=g("");K(async()=>{await D(f.params.productId),b.value&&await q()}),O(m,n=>{u.value=n.some(t=>t.product.id===f.params.productId)},{immediate:!0});const M=Q(()=>n=>n?nt(n).fromNow():"-"),U=async n=>{try{if(!b.value)return r("error","請先登入才能使用功能");const{status:t,message:s}=await I({productId:n,quantity:1});t==="success"&&r("success",s)}catch(t){r("error",t)}},B=async n=>{try{if(!b.value)return r("error","請先登入才能使用功能");if(u.value){const{status:t,message:s}=await P({productId:n});t==="success"&&(m.value=m.value.filter(_=>_.product.id!==n),r("success",s)),u.value=!1}else{const{status:t,message:s}=await A({productId:n});if(t==="success"){const _={product:a};m.value.push(_),r("success",s)}u.value=!0}}catch(t){r("error",t)}},T=async()=>{try{const n=f.params.productId;if(!v.value)return r("error","評論必須輸入內容");if(!p.value)return r("error","評論必須輸入等級");const s={...(await V({productId:n,comment:v.value,rating:p.value})).data.data.review,user:{username:S.value.name}};d.value=[s,...d.value]}catch(n){r("error",n)}},z=n=>{r("warning","確定要刪除此評論嗎?",!0).then(t=>{if(t.isConfirmed)return j(n)})};return(n,t)=>(c(),l("section",rt,[at,o(C)?(c(),l("p",it,i(o(C)),1)):y("",!0),o(a)?(c(),l("div",ct,[e("div",lt,[e("img",{src:o(a).image,alt:o(a).name,class:"img-fluid mb-3",style:{"max-width":"100%",height:"auto","box-shadow":"0 .5rem 1rem rgba(0,0,0,.15)"}},null,8,ut)]),e("div",dt,[e("h4",mt," 商品名稱： "+i(o(a).name),1),e("p",vt,"商品分類： "+i(o(a).category.name),1),e("p",pt,"商品敘述： "+i(o(a).description),1),e("p",_t,"商品單價： NT$ "+i(o(a).price),1),e("div",ft,[e("button",{class:W(["btn m-2",u.value?"btn-danger":"btn-primary"]),disabled:o(x),onClick:t[0]||(t[0]=s=>B(o(a).id))},i(u.value?"取消追蹤":"加入追蹤"),11,bt),e("button",{class:"btn btn-primary m-2",disabled:o(x),onClick:t[1]||(t[1]=s=>U(o(a).id))}," 加入購物車 ",8,ht),e("button",{class:"btn btn-outline-secondary m-2",onClick:t[2]||(t[2]=s=>o(F).go(-1))}," 返回 ")])])])):y("",!0),e("div",null,[gt,o(d)&&o(d).length?(c(),l("div",yt,[(c(!0),l(X,null,Y(o(d),s=>(c(),l("blockquote",{class:"blockquote mb-0",key:s.id},[o(S).isAdmin?(c(),l("button",{key:0,type:"button",onClick:_=>z(s.id),class:"btn btn-danger float-right"}," Delete ",8,wt)):y("",!0),e("h3",null,i(s.user.username),1),e("p",null,i(s.comment),1),e("footer",kt,i(M.value(s.createdAt)),1)]))),128)),xt])):(c(),l("p",St," 目前沒有評論 "))]),e("div",Ct,[Rt,R(e("select",{id:"rating","onUpdate:modelValue":t[3]||(t[3]=s=>p.value=s),class:"form-control",name:"rating",required:""},Nt,512),[[Z,p.value,void 0,{number:!0}]])]),e("form",null,[e("div",$t,[qt,R(e("textarea",{"onUpdate:modelValue":t[4]||(t[4]=s=>v.value=s),class:"form-control",rows:"3",name:"text"},null,512),[[tt,v.value]])]),e("div",At,[e("button",{type:"button",class:"btn btn-primary mr-0",onClick:t[5]||(t[5]=s=>T())}," Submit ")])])]))}};export{It as default};
