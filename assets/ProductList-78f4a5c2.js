import{u as D,a as L,b as R,s as y,c as N,o,d as r,e as s,t as k,n as P,f as c,g as O,h as V,i as I,r as M,j as T,k as U,F as q,w as z,v as E,l as Q,m as B,p as j,q as F}from"./index-ba497632.js";import{u as G}from"./cartStore-34a7c14a.js";import{S as H}from"./SpinnerLoading-c6094c35.js";const J={class:"card"},K=["src","alt"],W={class:"card-body"},X={class:"card-title mb-1"},Y={class:"card-text text-lg font-weight-bold text-info"},Z={class:"d-flex justify-content-end"},tt=["disabled"],et=["disabled"],A={__name:"ProductItem",props:{product:{type:Object,required:!0}},setup(n){const u=n,x=D(),h=L(),f=G(),g=R(),{isProcessing:v}=y(g),{isAuthenticated:_,favorites:m}=y(h),{addFavorite:b,removeFavorite:l}=h,{addCartItem:w}=f,{showAlert:i}=O(),p=N(()=>_.value?m.value.some(a=>a.product.id===u.product.id):!1),S=a=>{x.push({name:"ProductDetail",params:{productId:a}})},d=async a=>{try{if(!_.value)return i("error","請先登入才能使用功能");const{status:t,message:e}=await w({productId:a,quantity:1});t==="success"&&i("success",e)}catch(t){i("error",t)}},$=async a=>{try{if(!_.value)return i("error","請先登入才能使用功能");if(p.value){const{status:t,message:e}=await l({productId:a});t==="success"&&(m.value=m.value.filter(C=>C.product.id!==a),i("success",e))}else{const{status:t,message:e}=await b({productId:a});if(t==="success"){const C={product:u.product};m.value.push(C),i("success",e)}}}catch(t){i("error",t)}};return(a,t)=>(o(),r("div",J,[s("img",{class:"card-img-top",src:n.product.image,alt:n.product.name,onClick:t[0]||(t[0]=e=>S(n.product.id)),style:{height:"240px","object-fit":"cover"}},null,8,K),s("div",W,[s("h5",X,k(n.product.name),1),s("p",Y,"NT$ "+k(n.product.price),1),s("div",Z,[s("button",{class:P(["btn m-1",p.value?"btn-danger":"btn-primary"]),disabled:c(v),onClick:t[1]||(t[1]=e=>$(n.product.id))},k(p.value?"取消追蹤":"加入追蹤"),11,tt),s("button",{class:"btn btn-primary m-1",disabled:c(v),onClick:t[2]||(t[2]=e=>d(n.product.id))}," 加入購物車 ",8,et)])])]))}},st={class:"container mt-3"},ot={class:"nav nav-tabs mb-5"},rt={class:"nav-item"},ct={class:"nav-item"},at={key:0,class:"d-flex justify-content-between align-items-center mb-3"},nt=s("h3",{class:"font-weight-bold text-dark"},"上架商品",-1),it={style:{width:"200px"}},ut=s("option",{value:"createdAt"},"依上架時間排序",-1),lt=s("option",{value:"priceDesc"},"依金額高到低排序",-1),dt=s("option",{value:"priceAsc"},"依金額低到高排序",-1),vt=[ut,lt,dt],mt={key:1,class:"text-center text-danger"},pt={key:2},_t={key:0,class:"row"},yt={key:1,class:"text-center"},ht={key:2,class:"text-center"},ft={key:3,class:"row"},gt={key:0,class:"text-center"},wt={__name:"ProductList",setup(n){const u=V(),x=D(),h=L(),f=I(),{products:g,searchResult:v,searchQuery:_,sortedProduct:m,errorMessage:b,orderBy:l}=y(f),w=R(),{isLoading:i}=y(w),{favorites:p}=y(h),{getProducts:S}=f,d=M("products");T(async()=>{Object.keys(u.query).includes("keyword")&&(_.value=Object.values(u.query)[0]),l.value=u.query.orderBy||"createdAt",await S({...u.query,orderBy:l.value})});const $=()=>{x.replace({name:"ProductList",query:{...u.query,orderBy:l.value}})};return(a,t)=>(o(),r("section",st,[c(i)?(o(),U(H,{key:0})):(o(),r(q,{key:1},[s("ul",ot,[s("li",rt,[s("a",{class:P(["nav-link",{active:d.value==="products"}]),onClick:t[0]||(t[0]=e=>d.value="products"),style:{cursor:"pointer"}},"上架商品",2)]),s("li",ct,[s("a",{class:P(["nav-link",{active:d.value==="favorites"}]),onClick:t[1]||(t[1]=e=>d.value="favorites"),style:{cursor:"pointer"}},"追蹤商品",2)])]),d.value==="products"?(o(),r("div",at,[nt,s("div",it,[z(s("select",{class:"cursor-pointer form-control form-control-sm","onUpdate:modelValue":t[2]||(t[2]=e=>Q(l)?l.value=e:null),onChange:$,style:{width:"100%"}},vt,544),[[E,c(l)]])])])):B("",!0),c(b)?(o(),r("p",mt,k(c(b)),1)):B("",!0),d.value==="products"?(o(),r("div",pt,[c(v)&&c(v).length?(o(),r("div",_t,[(o(!0),r(q,null,j(c(m),e=>(o(),r("div",{key:e.id,class:"col-12 col-sm-6 col-lg-4 col-xl-3 mb-4"},[F(A,{product:e},null,8,["product"])]))),128))])):!c(v)&&c(g)&&!c(g).length?(o(),r("p",yt," 目前沒有商品 ")):(o(),r("p",ht," 找不到搜尋結果 "))])):(o(),r("div",ft,[(o(!0),r(q,null,j(c(p),e=>(o(),r("div",{key:e.product.id,class:"col-12 col-sm-6 col-lg-4 col-xl-3 mb-4"},[F(A,{product:e.product},null,8,["product"])]))),128)),c(p).length===0?(o(),r("p",gt," 還沒有追蹤任何商品 ")):B("",!0)]))],64))]))}};export{wt as default};
