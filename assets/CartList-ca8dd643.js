import{s as x,c as w,o as n,d as i,e as t,t as d,f as o,g as C,u as S,b as N,j as q,k as _,F as k,m as B,p as L}from"./index-ba497632.js";import{u as T}from"./orderStore-d52bf467.js";import{u as $}from"./cartStore-34a7c14a.js";import{S as j}from"./SpinnerLoading-c6094c35.js";const A={class:"border border-orange-400 text-center"},M=["src","alt"],O={class:"flex items-center justify-center"},R=["value"],F={__name:"CartItem",props:["cartItem"],setup(s){const m=s,h=$(),{updateCartItem:f,deleteCartItem:p}=h,{cartItems:c,errorMessage:g}=x(h),{showAlert:u}=C(),I=w(()=>m.cartItem.quantity*m.cartItem.product.price),y=(a,r)=>{try{const e=c.value.find(b=>b.id===a);if(r==="-")if(e.quantity>1)e.quantity--;else return u("warning","數量不能小於1");else e.quantity++}catch(e){g.value=e.message}},v=a=>{u("warning","確定要刪除商品嗎?",!0).then(r=>{if(r.isConfirmed)return p(a)})};return(a,r)=>(n(),i("tr",A,[t("td",null,[t("button",{onClick:r[0]||(r[0]=e=>v(s.cartItem.id))},"X")]),t("td",null,[t("img",{src:s.cartItem.product.image,class:"d-block mx-auto",style:{height:"80px",width:"80px","object-fit":"cover"},alt:s.cartItem.product.name},null,8,M)]),t("td",null,d(s.cartItem.product.name),1),t("td",null,"NT$ "+d(s.cartItem.product.price),1),t("td",null,[t("div",O,[t("button",{onClick:r[1]||(r[1]=e=>y(s.cartItem.id,"-"))},"-"),t("input",{type:"text",class:"mx-1 cursor-pointer border border-primary text-center",value:s.cartItem.quantity,onBlur:r[2]||(r[2]=e=>o(f)(s.cartItem.id,Number(e.target.value)))},null,40,R),t("button",{onClick:r[3]||(r[3]=e=>y(s.cartItem.id,"+"))},"+")])]),t("td",null,"NT$ "+d(I.value),1)]))}},P={class:"container my-5"},V=t("div",{class:"row"},[t("div",{class:"col"},[t("h3",{class:"mb-4 font-weight-bold d-flex align-items-center"}," 購物車 ")])],-1),D={key:0,class:"text-center text-danger"},E={key:1},Q={class:"table"},X=t("thead",null,[t("tr",null,[t("th",null,"刪除"),t("th",null,"圖片"),t("th",null,"名稱"),t("th",null,"單價"),t("th",null,"數量"),t("th",null,"總計")])],-1),z={key:2,class:"text-center"},G={class:"text-right mt-4"},H={class:"font-weight-bold h4"},J=["disabled"],Z={__name:"CartList",setup(s){const m=S(),h=T(),f=$(),{getCartItems:p}=f,{cartItems:c,totalPrice:g,errorMessage:u}=x(f),I=N(),{isLoading:y}=x(I),{postOrder:v}=h,{showAlert:a}=C();q(async()=>{try{await p()}catch(e){return a("error",e),m.replace({name:"ProductList"})}});const r=async()=>{const e=`總金額：NT$ ${g.value}`;a("info",`確定要結帳嗎? ${e} 元`,!0).then(async b=>{if(b.isConfirmed)try{const l=await v();l.data.status==="success"&&(c.value=[]),a("success",l.data.message)}catch(l){console.error(l)}})};return(e,b)=>(n(),i("section",P,[o(y)?(n(),_(j,{key:0})):(n(),i(k,{key:1},[V,o(u)?(n(),i("p",D,d(o(u)),1)):B("",!0),o(c)&&o(c).length?(n(),i("div",E,[t("table",Q,[X,t("tbody",null,[(n(!0),i(k,null,L(o(c),l=>(n(),_(F,{key:l.id,cartItem:l},null,8,["cartItem"]))),128))])])])):(n(),i("p",z," 購物車內沒有商品 ")),t("div",G,[t("p",H,"總金額： NT$ "+d(o(g)),1),t("button",{class:"btn btn-warning mt-3 px-5",disabled:!o(c).length,onClick:r}," 結帳 ",8,J)])],64))]))}};export{Z as default};
